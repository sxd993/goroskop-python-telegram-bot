# Telegram гороскоп-бот

## Поток работы бота

1. Пользователь отправляет `/start`. Бот сканирует `MEDIA_DIR` и предлагает выбрать тип гороскопа: годовой (`media/year/YYYY/sign.ext`) или месячный (`media/month/YYYY/MM/sign.ext`).
2. Для годового гороскопа: выбор года → выбор знака → создание заказа и оплата.
3. Для месячного гороскопа: выбор года → выбор месяца → выбор знака → создание заказа и оплата.
4. При выборе знака проверяется наличие файла (файлы `sign.ext` или подпапки со знаком). Создается заказ в SQLite, показывается цена и кнопка оплаты.
5. При оплате отправляется invoice через Telegram/YooKassa, после успешного платежа файл отправляется как документ. Все статусы заказа сохраняются.

## Ключевые зависимости

- `aiogram` — маршрутизация и работа с Telegram Bot API.
- `aiosqlite` — асинхронная работа с SQLite.
- `pydantic-settings` — загрузка настроек из `.env`.

Цена по умолчанию 390 ₽ (39000 копеек). База SQLite `data/bot.sqlite3`.

## Запуск

1. Создай и активируй виртуальное окружение.
2. Установи зависимости: `pip install -r requirements.txt`.
3. Заполни `.env`: `BOT_TOKEN`, `PROVIDER_TOKEN`, опционально `PRICE_KOPEKS`, `CURRENCY`, `MEDIA_DIR`, `DB_PATH`.
   - Для доступа к админ-меню (загрузка прогнозов) укажи `ADMIN_IDS` — список ID через запятую.
4. Подготовь медиа:
   - Годовой: `media/year/2025/aries.jpg`.
   - Месячный: `media/month/2025/01/aries.jpg`.
5. Запусти бота:
   ```bash
   python app.py
   ```

## Структура кода

- `app.py` — точка входа: загрузка настроек, инициализация БД, сборка бота.
- `app/config.py` — настройки, константы (месяцы, знаки, расширения).
- `app/models.py` — типы и модели (заказ).
- `app/services/` — бизнес-логика:
  - `media.py` — сканирование медиа, поиск лет/месяцев/знаков и файлов.
  - `db.py` — работа с SQLite, статусы заказов.
  - `parsing.py` — парсинг callback-данных.
  - `messaging.py` — отправка файлов.
- `app/keyboards/` — инлайн-клавиатуры для навигации и оплаты.
- `app/texts.py` — тексты и билдеры сообщений.
- `app/handlers/` — aiogram-роутеры и обработчики.
